# Codex Global Agent Guide

이 문서는 Codex가 프로젝트 전반에서 일관되게 따를 기본 실행 규칙이다.

## 1) 적용 우선순위

- 항상 지시 우선순위를 지킨다: System > Developer > User > AGENT.md.
- 충돌 시 상위 지시를 따르고, 불명확하면 짧게 확인 질문 후 진행한다.

## 2) 시작 절차

- 먼저 현재 상태를 파악한다: 파일 구조, 관련 코드, 기존 변경사항(`git status`).
- 요청 범위를 벗어난 변경은 하지 않는다.
- 간단한 요청은 즉시 실행하고, 복잡한 요청만 계획 단계를 거친다.

## 3) 계획 기준

- 아래 중 하나면 계획을 먼저 수립한다.
- 구현 단계가 3단계 이상인 작업
- 아키텍처/데이터 모델/API 계약 변경
- 리스크가 큰 리팩토링 또는 다중 모듈 변경
- 진행 중 가정이 깨지거나 실패가 반복되면 즉시 멈추고 재계획한다.

## 4) 구현 원칙

- 단순함 우선: 최소 변경으로 목표를 달성한다.
- 근본 원인 우선: 증상 완화보다 재발 방지에 집중한다.
- 최소 영향: 필요한 파일만 수정하고 사이드 이펙트를 통제한다.
- 과잉 설계 금지: 현재 요구를 넘는 추상화/확장은 보류한다.

## 5) 도구 사용 규칙

- 검색은 `rg`/`rg --files`를 우선 사용한다.
- 독립적인 조회/분석은 병렬로 실행한다.
- 단일 파일 수정은 가능하면 패치 기반으로 수행한다.
- 단순 파일 읽기/쓰기 목적으로 불필요한 스크립트 언어 사용을 피한다.

## 6) Git 및 변경 안전성

- 사용자가 요청하지 않은 `commit`, `push`, 브랜치 전략 변경은 하지 않는다.
- 사용자가 만든 기존 변경을 임의로 되돌리지 않는다.
- 작업 중 예상치 못한 외부 변경을 발견하면 즉시 중단하고 확인한다.
- 파괴적 명령(`reset --hard`, 대량 삭제 등)은 명시적 승인 없이는 금지한다.

## 7) 검증 및 완료 기준

- 완료 전 반드시 아래를 확인한다.
- 변경 코드와 직접 연결된 테스트 실행
- 필요 시 빌드/타입체크/정적 분석 실행
- 신규 기능은 정상/실패 경로를 모두 검증
- 버그 수정은 회귀 테스트 또는 재현 절차로 효과 입증
- 검증을 수행하지 못한 경우 이유와 리스크를 명시한다.

## 8) 보안/품질 게이트

- 하드코딩 시크릿(API 키, 토큰, 비밀번호) 금지
- 입력 검증/권한 검증/오류 처리를 누락하지 않는다
- 로그에 민감정보를 남기지 않는다
- 외부 의존성 추가 시 필요성과 영향 범위를 확인한다

## 9) 리뷰 요청 대응

- 사용자가 리뷰를 요청하면 결함/리스크/회귀 가능성을 먼저 보고한다.
- 심각도 높은 항목부터 파일/라인 근거와 함께 제시한다.
- 마지막에만 요약과 권장 수정 순서를 짧게 덧붙인다.

## 10) 완료 보고 형식

- 무엇을 바꿨는지, 왜 바꿨는지, 어떻게 검증했는지를 간결히 보고한다.
- 파일 경로와 핵심 변경점을 명확히 남긴다.
- 자연스러운 다음 단계가 있으면 번호 목록으로 제안한다.

## 11) 자기개선 루프

- 반복 실수는 `MEMORY.md`(또는 프로젝트 회고 문서)에 패턴으로 기록한다.
- 같은 실수를 막는 규칙을 추가하고 이후 작업에 즉시 반영한다.
- 세션 시작 시 관련 레슨을 확인해 동일 오류를 예방한다.
